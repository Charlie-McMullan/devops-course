name: Deploy

on: 
  push:
    branches:
      - main
      - prod

jobs:
  test-lint:
    uses: ./.github/workflows/test-and-lint.yml
    name: Test and Lint 
    secrets:
      DOCKERHUB_USER: ${{ vars.DOCKERHUB_USER }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}

    deploy:
      name : Deploy
      runs-on: ubuntu-22.04
      needs: [test-lint]
      steps:
        - name: Checkout
          uses: actions/checkout@v4
        - name: Set vars
          run: |
            if [[ $GITHUB_REF == 'refs/heads/prod']]; then
              echo "prod" > .workspace
            else
              echo "staging" > .workspace
            fi
